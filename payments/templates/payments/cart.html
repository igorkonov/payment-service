{% load static %}
{% load payment_filters %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ—Ä–∑–∏–Ω–∞</title>
    <link rel="stylesheet" href="{% static 'payments/css/main.css' %}">
    <link rel="stylesheet" href="{% static 'payments/css/cart.css' %}">
    <style>
        body {
            max-width: 900px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üõí –ö–æ—Ä–∑–∏–Ω–∞ ({{ cart_count }} —Ç–æ–≤–∞—Ä{{ cart_count|pluralize:"–æ–≤" }})</h1>
        <a href="{% url 'payments:index' %}" class="back-link">‚Üê –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∫—É–ø–∫–∏</a>
    </div>

    {% if error %}
        <div class="cart-empty">
            <p style="color: #fa755a;">{{ error }}</p>
            <p>–ö–æ—Ä–∑–∏–Ω–∞ –±—ã–ª–∞ –æ—á–∏—â–µ–Ω–∞.</p>
            <a href="{% url 'payments:index' %}" class="btn">–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–∫—É–ø–∫–∞–º</a>
        </div>
    {% elif cart_items %}
        {% for cart_item in cart_items %}
        <div class="cart-item">
            <div class="item-info">
                <h3>{{ cart_item.item.name }}</h3>
                <p>{{ cart_item.item.description }}</p>
                <div class="quantity-controls">
                    <a href="{% url 'payments:update_cart_quantity' cart_item.item.id 'decrease' %}" class="qty-btn">‚àí</a>
                    <span class="qty-display">{{ cart_item.quantity }}</span>
                    <a href="{% url 'payments:update_cart_quantity' cart_item.item.id 'increase' %}" class="qty-btn">+</a>
                </div>
            </div>
            <div class="item-price">
                {% if currency == 'usd' %}${% else %}‚Ç¨{% endif %}{{ cart_item.subtotal|cents_to_currency }}
                {% if cart_item.converted %}
                <div style="font-size: 12px; color: #8898aa; margin-top: 4px;">
                    (–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –∏–∑ {% if cart_item.original_currency == 'usd' %}${% else %}‚Ç¨{% endif %})
                </div>
                {% endif %}
            </div>
            <a href="{% url 'payments:remove_from_cart' cart_item.item.id %}" class="remove-btn">–£–¥–∞–ª–∏—Ç—å</a>
        </div>
        {% endfor %}

        <div class="cart-summary">
            <div class="summary-row">
                <span>–¢–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ:</span>
                <span>{{ cart_count }}</span>
            </div>

            <div class="summary-row" style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #e6ebf1;">
                <span><strong>–í–∞–ª—é—Ç–∞ –æ–ø–ª–∞—Ç—ã:</strong></span>
                <div style="display: flex; gap: 10px;">
                    <a href="{% url 'payments:change_currency' 'usd' %}"
                       class="currency-btn {% if currency == 'usd' %}active{% endif %}"
                       style="padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600; transition: all 0.2s; {% if currency == 'usd' %}background: #5469d4; color: white;{% else %}background: #f6f9fc; color: #525f7f;{% endif %}">
                        üíµ USD
                    </a>
                    <a href="{% url 'payments:change_currency' 'eur' %}"
                       class="currency-btn {% if currency == 'eur' %}active{% endif %}"
                       style="padding: 8px 16px; border-radius: 6px; text-decoration: none; font-weight: 600; transition: all 0.2s; {% if currency == 'eur' %}background: #5469d4; color: white;{% else %}background: #f6f9fc; color: #525f7f;{% endif %}">
                        üí∂ EUR
                    </a>
                </div>
            </div>

            <div class="summary-total">
                <span>–ò—Ç–æ–≥–æ:</span>
                <span>
                    {% if currency == 'usd' %}${% else %}‚Ç¨{% endif %}{{ total|cents_to_currency }}
                </span>
            </div>
            <a href="{% url 'payments:checkout_cart' %}" class="checkout-btn">
                –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
            </a>
        </div>
    {% else %}
        <div class="cart-empty">
            <p>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>
            <a href="{% url 'payments:index' %}" class="btn">–ü–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ–∫—É–ø–∫–∞–º</a>
        </div>
    {% endif %}
</body>
</html>
